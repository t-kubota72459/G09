# MicroPythonライントレーサー製作 授業計画書【最終版 v5】

### 概要
本計画は、全9回の実践的な演習授業プランです。ハードウェアの進捗遅れ、および部品の追加（DCDCコンバータ、センサー基板）を考慮し、**第5回を「はんだ付け・ハードウェア製作」に特化させた回**として再編成しています。学生は、電源ノイズを考慮した「電源分離」や、自作基板のデバッグといった、より実践的なエンジニアリング課題に挑戦します。

---

## 第1回～第4回（ダイジェスト）

* **第1回:** ESP32-DevKitCで環境構築とLチカ。
* **第2回:** ESP32-DevKitCでモータードライバとPWM制御。
* **第3回:** ESP32-DevKitCでRPR-220のセンサー値をA/D変換で読み取り。
* **第4回:** XIAO ESP32C3へコードを「移植」。XIAOでのLED、センサーの動作確認。（※進捗：モーター制御等は未完）

---

## 第5回：【最難関】ハードウェア製作「地獄のはんだ付け」

* **目標:** 2種類の基板（DCDCコンバータ、センサー）をはんだ付けで完成させ、テスターで動作確認（導通・ショート）できる。
* **💡指導のヒント:**
    > この回は「**はんだ付け回**」です。200分のほぼ全てを製作に費やします。学生が最も難儀する回であり、ここを乗り越えることが最大の学びです。「動かないのが当たり前、デバッグが本番」と伝えます。

* **課題1：DCDCコンバータキットの製作 (60分)**
    * **タスク:** 秋月電子の「AE-LXDC55-3V3」キットを説明書通りにはんだ付けし、完成させる。
* **課題2：センサー基板のレイアウト設計 (30分)**
    * **タスク:** 2x8cmユニバーサル基板を使い、RPR-220 x 2、プルアップ抵抗 x 2、ピンヘッダの最適な配置を紙にスケッチする。
    * **考慮点:** 進行方向に対しLEDを先にする。ジャンパ線の数を最小限にする。
* **課題3：センサー基板のはんだ付け (90分)**
    * **タスク:** スケッチに基づき、はんだ付けを行う。
    * **【力技】** はんだ付け**前**に、RPR-220の足をラジオペンチで優しく曲げ、「ハの字」の角度をつけることに挑戦する。
* **課題4：デバッグタイム（テスター必須） (20分)**
    * **タスク:** 完成した2つの基板に、電源を**入れる前に**必ずテスターを当てる。
    * **チェック:** (1)VccとGNDがショートしていないか、(2)DCDCコンバータの入力と出力がショートしていないか、(3)センサー基板の抵抗や配線が正しいか。

---

## 第6回：マシン合体と「電源分離」の実装

* **目標:** 全ての自作コンポーネントを車体に搭載し、「電源分離」を理解して配線。オンオフ制御でコースを完走させる。
* **課題1：ハードウェア動作確認 (40分)**
    * **タスク:** 第5回で製作した基板の動作確認。
        1. DCDCコンバータに4.8Vを入力し、テスターで3.3Vがクリーンに出力されるか確認。
        2. XIAOとセンサー基板を3.3Vで動かし、第3回のプログラムでセンサー値が取れるか確認。
* **課題2：XIAOでのモーター制御確認 (40分)**
    * **タスク:** XIAOでモーター制御プログラム（`forward`, `stop`等）が動作することを、車体を浮かせて確認する。
* **課題3：完全実装と「電源分離」配線 (80分)**
    * **タスク:** 全パーツ（XIAO, 自作センサー, モータードライバ, 自作DCDC, 電池ボックス, ボールキャスター）を「貼り付けボス」などで車体に固定する。
    * **【最重要】** 以下の「電源分離」配線を正しく行う。
        1. **4.8V系（パワー）:** 電池ボックス → **モータードライバ**
        2. **3.3V系（ロジック）:** 電池ボックス → **DCDCコンバータ(IN)** → **DCDC(OUT 3.3V)** → **XIAO(3V3ピン)** と **自作センサー基板(Vcc)**
    * **💡指導のヒント:** センサー基板はボールキャスターより**できるだけ前方**に突き出すよう指導する。
* **課題4：オンオフ制御での初完走 (40分)**
    * **タスク:** 全ての配線が完了したマシンで、オンオフ制御プログラムを動かし、低速でコースを1周完走させる。

---

## 第7回：【選択制】制御のアップグレード

* **目標:** オンオフ制御を極めるか、P制御の滑らかさに挑戦するか、学生が自身の進捗と興味に応じて選択する。
* **💡指導のヒント:**
    > 「P制御は難しいが、P制御でしか出せない滑らかさがある。一方、オンオフ制御でもチューニングを極めれば勝てる。自分のマシンに合う方を選ぼう」と促す。

* **A：P制御（比例制御）への挑戦コース (200分)**
    * **タスク:** `偏差 = 右センサー値 - 左センサー値` を使ったP制御を実装する。
    * **タスク:** 「なぜP制御は滑らかに走るのか」を体感し、`Kp`（比例ゲイン）の調整に挑戦する。

* **B：オンオフ制御の「チューニング」コース (200分)**
    * **タスク:** オンオフ制御のまま、「直進速度」と「旋回速度（または旋回時間）」のパラメータを調整し、できるだけ速く安定した走行を目指す。
    * **タスク:** ハードウェアの調整（センサーの角度、おもりの追加など）にも挑戦する。

---

## 第8回：決戦準備！最適化とレポート作成

* **目標:** 自分の選んだ制御方式で、タイムトライアルに向けた最高性能を引き出す。
* **課題1：模擬タイムトライアル (100分)**
    * **タスク:** 本番コースでタイムを計測し、問題点を洗い出す。P制御の学生は`Kp`と基本速度の最適なバランスを、オンオフ制御の学生はギリギリの速度設定を探る。
* **課題2：レポート作成セッション (100分)**
    * **タスク:** 自分のマシンで最も工夫した点、特に「**自作したハードウェア（DCDC, センサー基板）の設計とデバッグ**」および「**選んだ制御方式（オンオフ or P）のチューニング過程**」をレポートにまとめる。

---

## 第9回：栄光は誰の手に！タイムトライアル＆発表会

* **目標:** 成果を披露し、他者のアプローチから学ぶ。
* **内容:** (変更なし)
    1.  **最終調整と練習走行 (60分)**
    2.  **タイムトライアル本番 (100分)**
        * P制御の滑らかなマシンと、オンオフ制御のキビキビしたマシンが混在する、多様性のあるレースとなる。
    3.  **成果発表会と総括 (40分)**
        * 「オンオフ制御で優勝した秘訣」や「P制御の調整で苦労した点」「はんだ付けで苦労した点」などを共有する。