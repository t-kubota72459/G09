---

# MicroPythonライントレーサー製作 授業内課題リスト

### 概要
本資料は、全9回のライントレーサー製作授業において、各回（200分）で学生が取り組むべき具体的なタスク、エクササイズ、および発展課題をまとめたものです。

---

## 第1回：評価ボード(DevKitC)と対話しよう

### 課題1：環境構築と初コンタクト (60分)
* **タスク:** 自分のPCで開発環境（Thonny）をセットアップし、**ESP32-DevKitC**にMicroPythonを書き込む。`print("Hello, [自分の名前]!")` と表示させるプログラムを実行し、マイコンとの通信を確立する。

### 課題2：Lチカとピン変数 (90分)
* **タスク:** ブレッドボード上にLEDと抵抗を配線する。DevKitCのピン配置図を見て、出力として使えるGPIOピンを一つ選び、`led_pin = 2` のように**変数として定義**する。そのピンを使って1秒周期でLEDを点滅させる。

### 課題3：SOS信号をプログラムせよ (50分)
* **タスク:** Lチカのプログラムを改造し、光で「SOS」信号（・・・－－－・・・）を表現する。短い点滅（点）と長い点滅（線）を使い分けるために、`time.sleep()`の時間を調整する。

### 🚀 発展課題
* **タスク:** `machine.PWM`を使い、LEDの明るさを徐々に明るくし、徐々に暗くする「ホタル」のような光らせ方に挑戦してみよう。

---

## 第2回：モーターを(DevKitCで)解き放て

### 課題1：モータードライバの配線 (50分)
* **タスク:** モータードライバのデータシートを見ながら、ESP32-DevKitC、モーター2個、そして外部電源（電池ボックス）をブレッドボード上で正しく配線する。

### 課題2：片輪走行とPWM制御 (60分)
* **タスク:** まずは片方のモーターだけを制御するプログラムを作成する。PWMのデューティー比を25%、50%、100%と変えながら、2秒間正転し、2秒間停止する動きを実装する。

### 課題3：動作を関数にまとめよう (90分)
* **タスク:** `forward(speed)`, `stop()`, `turn_right(speed)` のように、マシンの基本動作を関数として定義する。これらの関数を呼び出すだけで、マシンが意図通りに動くことを確認する。

### 🚀 発展課題
* **タスク:** 作成した関数を組み合わせて、「3秒前進→その場で2秒右回転→2秒後退」のような、オリジナルの「ダンス」プログラムを作成してみよう。

---

## 第3回：光で線を(DevKitCで)見つけ出せ

### 課題1：センサー回路の追加 (50分)
* **タスク:** RPR-220センサー2個分の回路（プルアップ抵抗を含む）をブレッドボードに追加配線する。

### 課題2：センサー値の「見える化」 (90分)
* **タスク:** 2つのセンサーからのアナログ値を`machine.ADC`で連続的に読み取り、`print()`でコンソールに表示し続けるプログラムを作成する。実際にセンサーをコースの白い部分と黒い部分の上にかざし、数値がどのように変化するかを観察・記録する。

### 課題3：白黒判定マシーン (60分)
* **タスク:** 課題2の観察結果をもとに、白と黒を分ける境界となる「**閾値（THRESHOLD）**」を定数として定義する。`is_black(sensor_value)`という関数を作成し、センサー値が閾値より大きい場合に`True`を返すように実装する。

### 🚀 発展課題
* **タスク:** センサーが黒い線を検知したら、第1回で使ったLEDが点灯する「スタートライン検出器」を作成してみよう。

---

## 第4回：頭脳移植と初めてのライントレース

### 課題1：魂のコード移植 (70分)
* **タスク:** 第2回、第3回で作成したプログラムの**ピン定義変数**だけを、**XIAO ESP32C3**のピン配置図に合わせて書き換える。XIAOに書き込み、LED、モーター、センサーがDevKitCの時と同じように動作するか、個別にテストする。

### 課題2：車体へのマウント (60分)
* **タスク:** XIAO、モータードライバ、センサー、電池ボックスなど、全ての部品をライントレーサーの車体に搭載し、配線する。断線しないよう、丁寧な作業を心がける。

### 課題3：感動の初走行！オンオフ制御 (70分)
* **タスク:** センサーとモーターのプログラムを統合し、「右が黒なら左へ、左が黒なら右へ、両方白なら前へ」というシンプルなオンオフ制御のロジックを実装し、実際にコースを走らせる。

### 🚀 発展課題
* **タスク:** 車体にタクトスイッチを追加し、スイッチが押されるまで走行を開始しないスタート制御を実装してみよう。

---

## 第5回：P制御への道

### 課題1：偏差の計算と観察 (60分)
* **タスク:** センサー値を正規化（例：0〜1000の範囲に変換）し、`偏差 = 右センサー値 - 左センサー値` を計算して`print()`で表示し続ける。手でマシンを左右にずらしながら、偏差の値がどのように変わるか観察する。

### 課題2：P制御の実装 (80分)
* **タスク:** `操作量 = Kp * 偏差` という計算式をプログラムに組み込む。`左モーター速度 = 基本速度 + 操作量`、`右モーター速度 = 基本速度 - 操作量` のように、偏差に応じて左右のモーター速度を変化させる。

### 課題3：Kpチューニング実験 (60分)
* **タスク:** 比例ゲイン`Kp`の値を、**(A)小さすぎる値、(B)ちょうど良い値、(C)大きすぎる値**の3パターン以上試し、それぞれのマシンの挙動（反応が鈍い、滑らか、振動しすぎる等）を動画で撮影し、記録する。

### 🚀 発展課題
* **タスク:** 起動時に5秒間、白と黒の上でセンサーを動かしてキャリブレーション（最大値と最小値を自動で取得）する機能を実装し、照明環境の変化に強くしてみよう。

---

## 第6回：PD制御で安定走行

### 課題1：微分項の導入と観察 (60分)
* **タスク:** 1ループ前の偏差を記憶する`previous_deviation`変数を追加し、`微分値 = 今回の偏差 - 前回の偏差`を計算する。この微分値を`print()`で表示し、特にカーブに差し掛かる瞬間に値が大きく変化することを観察する。

### 課題2：PD制御の実装 (60分)
* **タスク:** `操作量 = Kp * 偏差 + Kd * 微分値` という、PD制御の完全な式を実装する。

### 課題3：匠のチューニング (80分)
* **タスク:** `Kp`と`Kd`のバランスを探る。まず`Kd`を0にして`Kp`を調整し、次に`Kp`を固定して`Kd`を調整するなど、系統的なアプローチで最適なパラメータセットを見つけ出す。

### 🚀 発展課題
* **タスク:** 偏差の絶対値が大きい（＝急カーブ）の時だけ、マシンの基本速度を自動的に落とす「インテリジェント速度制御」を実装してみよう。

---

## 第7回：制御の頂きへ！（調整デー）

### 課題A：PD制御のマスター (200分)
* **タスク（推奨）：** タイムトライアル本番のコースを使い、最速タイムを目指してPD制御のパラメータを徹底的にチューニングする。ハードウェア（センサーの「ハの字」配置など）の改善にも取り組む。

### 課題B：PID制御への挑戦 (200分)
* **タスク（上級者向け）：** 偏差の累積値（積分項）をプログラムに追加し、PID制御を実装する。3つのパラメータ（Kp, Ki, Kd）の調整という、より複雑なチューニングに挑戦する。

### 🚀 発展課題
* **タスク:** コースに十字路やT字路を設置し、それを検知して停止する、あるいは左右に曲がるなどの高度な制御に挑戦してみよう。

---

## 第8回：決戦の準備！

### 課題1：模擬タイムトライアル (100分)
* **タスク:** 本番と同じルールで、3周連続走行のタイムを計測する。最もタイムロスが大きいコーナーや、脱線しやすい箇所を特定し、その区間を攻略するための最終調整を行う。

### 課題2：レポート執筆セッション (100分)
* **タスク:** 自分のライントレーサーの「こだわり」を文章化する。特に、**(1)実装した制御アルゴリズムの解説**、**(2)パラメータ調整の試行錯誤の過程** の2つのセクションを、具体的な数値や観察結果を交えて記述する。

### 🚀 発展課題
* **タスク:** ESP32のWi-FiやBluetooth機能を使い、PCやスマホから無線でKp, Kdの値をリアルタイムに書き換えられるようにする。これにより、チューニングの効率が劇的に向上する。

---

## 第9回：栄光は誰の手に！

### 課題1：最終車検と練習走行 (60分)
* **タスク:** 当日の照明環境に合わせて、センサーの閾値などを微調整する。教員による車検（レギュレーションチェック）を受け、最後の練習走行を行う。

### 課題2：タイムトライアル本番！ (100分)
* **タスク:** 各自3回の走行を行い、ベストタイムを記録する。他の学生の走りを見て、アルゴリズムやセッティングの違いを考察する。

### 課題3：成果発表とナレッジ共有 (40分)
* **タスク:** 自分のマシンで最も工夫した点（ソフトウェア、ハードウェア問わず）を1分間でプレゼンテーションする。他の学生からの質問に答える。