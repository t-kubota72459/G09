# MicroPythonライントレーサー製作 授業計画書

### 概要
本計画は、PythonとMicrobitの基礎知識を持つ大学2年生を対象とした、全9回（各200分）の実践的な演習授業のプランです。開発初期には汎用的な**ESP32-DevKitC**を使用し、途中で本番用の小型マイコン**Seeed Studio XIAO ESP32C3**へプログラムを移植するプロセスを経験することで、より実践的なエンジニアリングスキルを習得することを目的とします。

---

## 第1回：冒険の始まり！評価ボード(DevKitC)と対話しよう

* **目標:** 大型の評価ボードを使い、マイコン開発の基本フローを確実にマスターする。
* **使用マイコン:** **ESP32-DevKitC**
* **主な内容:**
    1.  **イントロダクション:** ライントレーサーの完成形動画を視聴し、最終目標（タイムトライアル）を共有する。
    2.  **環境構築:** ESP32-DevKitCにMicroPythonファームウェアを書き込み、開発環境（Thonny）と接続する。
    3.  **Lチカ:** ブレッドボード上にLEDを配線し、点滅させる。データシートでピン配置を確認する練習を行う。
* **💡指導のヒント:**
    > この段階から、ピン番号を直接書くのではなく、`led_pin = 2` のように**変数として定義する**コーディングスタイルを徹底させます。これが後の「移植」作業で非常に重要になります。

---

## 第2回：マシンに命を！モーターを(DevKitCで)解き放て

* **目標:** ブレッドボード上で、モータードライバを介したモーター制御を完璧に実装する。
* **使用マイコン:** **ESP32-DevKitC**
* **主な内容:**
    1.  モータードライバとDevKitCをブレッドボード上で配線する。
    2.  `machine.PWM` を用いたPWM制御のプログラムを作成し、前進・後退・旋回・速度調整を実装する。
* **💡指導のヒント:**
    > DevKitCはピンが豊富です。どのGPIOピンをモーター制御に使うか学生自身に選ばせ、その理由を考えさせると主体性が育ちます。

---

## 第3回：マシンの眼！光で線を(DevKitCで)見つけ出せ

* **目標:** センサー回路をブレッドボード上で完成させ、閾値のキャリブレーション手法を確立する。
* **使用マイコン:** **ESP32-DevKitC**
* **主な内容:**
    1.  フォトトランジスタ（RPR-220）の回路をブレッドボードに追加する。
    2.  DevKitCのADC（A/D変換）が可能なピンを調べ、接続する。
    3.  白い面と黒い線の上でセンサー値を`print()`で観測し、閾値を決定するプログラムを作成する。
* **💡指導のヒント:**
    > 授業の最後に、「来週、この作り上げた『魂のコード』を、いよいよ本番用の小さなマイコンに移植する！」と宣言し、次週への期待感を高めましょう。

---

## 第4回：頭脳移植！XIAOへのコード移行と初めてのライントレース

* **目標:** コードの移植性を理解し、小型マイコンを車体に搭載して、初めてのライントレースを成功させる。
* **使用マイコン:** **Seeed Studio XIAO ESP32C3**
* **主な内容:**
    1.  **ハードウェア比較:** DevKitCとXIAO ESP32C3を並べ、サイズ、ピン数、ピン配置の違いを観察・議論する。
    2.  **コード移植:** これまで作成したコードの**ピン定義変数**を、XIAOのピン配置に合わせて書き換える。ロジック部分の変更が不要なことを体感させる。
    3.  **車体実装:** XIAOと各モジュールをライントレーサーの車体に本格的に搭載する。
    4.  **オンオフ制御:** 移植・統合したプログラムで、最初のライントレース（オンオフ制御）に挑戦する。
* **💡指導のヒント:**
    > DevKitCとXIAOのピン配置図を並べた比較資料を配布すると、移植作業がスムーズに進み、学生の混乱を防げます。

---

## 第5回：滑らかさを求めて！P制御への道

* **目標:** オンオフ制御の課題（蛇行）を改善するため、P（比例）制御の概念を理解し、実装する。
* **使用マイコン:** **Seeed Studio XIAO ESP32C3**
* **主な内容:**
    1.  `偏差 = 右センサー値 - 左センサー値` の考え方を学ぶ。
    2.  偏差に比例してモーターの出力を変えるP制御を実装する。
    3.  比例ゲイン（Kp）を調整し、走行がどう変わるか実験・考察する。

---

## 第6回：未来を予測せよ！PD制御で安定走行

* **目標:** P制御の課題（急カーブでの飛び出し）を克服するため、D（微分）制御を追加し、より安定した走行を実現する。
* **使用マイコン:** **Seeed Studio XIAO ESP32C3**
* **主な内容:**
    1.  偏差の変化量（微分項）をプログラムに導入する考え方を学ぶ。
    2.  PD制御を実装する。
    3.  KpとKd、2つのパラメータを調整する「チューニング」の難しさと面白さを体験する。

---

## 第7回：制御の頂きへ！PID制御の探求（または調整デー）

* **目標:** 各自のマシンの完成度を高める。
* **使用マイコン:** **Seeed Studio XIAO ESP32C3**
* **主な内容:**
    1.  **選択制:** PD制御のパラメータチューニングを極めるか、さらに発展的なI（積分）制御を加えたPID制御に挑戦するかを学生が選択する。
    2.  コースの難所（S字カーブなど）を攻略するための調整に時間を充てる。

---

## 第8回：決戦の準備！最適化とレポート作成

* **目標:** タイムトライアルで最高性能を発揮できるようマシンを最終調整し、学びをレポートとして言語化する。
* **使用マイコン:** **Seeed Studio XIAO ESP32C3**
* **主な内容:**
    1.  **最終調整:** ソフトウェア（パラメータ）とハードウェア（センサー位置、車体バランス）の両面から最適化を行う。
    2.  **レポート作成:** これまでの設計、実装、実験、考察のプロセスをレポートにまとめる。

---

## 第9回：栄光は誰の手に！タイムトライアル＆発表会

* **目標:** 最高の走りを披露し、仲間たちの多様なアプローチから学び、プロジェクト全体を締めくくる。
* **使用マイコン:** **Seeed Studio XIAO ESP32C3**
* **主な内容:**
    1.  **タイムトライアル:** 設定されたコースで走行タイムを競う。
    2.  **成果発表会:** 上位入賞者やユニークな工夫をした学生が、自分のマシンの「こだわりポイント」を発表する。
    3.  **総括:** 全9回の学びを振り返り、レポートを提出する。