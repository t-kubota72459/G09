# PLC 応用編

第４クォーターは、１年生のときに製作したピックアンドプレース (以下、P&P) を PLC ではなくマイコンから制御する技術を学びます。

## 単位の認定

これまでの第１、第２クォーターの出席と第４クォーターの授業まで受講することで「マイコン実習」８単位を取得できます。
部分認定（２単位だけ、４単位だけ）はありません。

## 授業の時間

授業：２回 / 週 (月曜日と火曜日の午前中), １回につき４時間 (200分)

途中、１月に技能照査「マイコン」 (「技能士補」の資格が取得できる認定試験) がある。そちらの試験対策を、２回予定。

## 授業のゴール

ここから、主に PLC とマイコンの共存について学習する。

1. CQ出版の基板を製作・動作確認し、ESP32の基本操作を習得。
1. OpenPLCを用いた制御プログラミングを理解。
1. 完成済みのピックアンドプレースシステムを使い、協調制御を学ぶ。

## 教科書

必要に応じて配布する。ただし、これまでのマイコン、PLC の知識を前提とするので、

- マイコン制御の教科書
- プログラム言語の教科書
- 情報処理実習の教科書
- センサ工学の教科書

などは手元においておくとよい。

# 基板の製作と基本動作確認 

# CQ 出版 ESP32 を用いた PLC 基板

## まず電圧変換ありき

「FA システム制御実習」などで習ったと思うが、PLC など生産システムの制御系は基本的に 24V で動作している。

一方、Arduino や　RaspberryPi といったマイコンは主に 5V, 3.3V, 1.8V といった小さい電圧で動作している。マイコンは低消費電力を求められているため、ますます動作電圧は低くなる傾向にある。

この２つを融合させて扱おうとすると、まずそれぞの動作に適している電圧に変換しなくてはならない。

PLC 用に設計された近接センサーなどからの 24V の信号は 5V や 3.3V に落とし、マイコンからアクチュエーターへの 3.3V や 5V 出力は 24V に変換する必要がある。

そのための変換回路を作ることは、みなさんならさほど難しくないが、今回は CQ 出版から販売されている ESP32 用基板を利用することとする。

<img width="60%" src="https://interface.cqpub.co.jp/wp-content/uploads/plc-2048x1548.png">

基板の左側がマイコンへの入力、基板の右側がマイコンからの出力になっている。

[基板の回路図](https://interface.cqpub.co.jp/wp-content/uploads/plc.pdf)

外部入力は９つ、外部出力は１０個ある。またアナログ出力が２つある。

それぞれ動作確認ができるように、タクトスイッチと LED がつけられている。

電源はマイコンに USB 接続するか、DCジャックから電圧を加える (定格電圧 35V)。

**これから基板をハンダ付けするが、この基板は後輩に託すため、丁寧に仕上げること。**

## 部品点数を確認する

部品に過不足がないか、確認する。

特に抵抗はカラーコードを確認し、値と個数にまちがいがないかよく確認する。

各値ごとに整理してくとはんだ付けがスムーズにすすむ。

[パーツセット部品表](https://akizukidenshi.com/goodsaffix/20240520_129479_CQ-ESP32-PLC-IO-K_部品表_公開用.pdf)

## はんだ付けをする

はんだ付けは印刷のある面（シルク面という）に部品を配置し、ハンダ面（ランドのある裏面）からはんだ付けしていく。

### ステップ１　抵抗をつける

まず、背の低い電子部品から取り付ける。抵抗が一番背が引くため、抵抗から取り掛かる。
リード線ベンダを使って、リード線を曲げ、正しい箇所に取り付ける。

抵抗に向き (極性) はないが、見た目の美しさと確認しやすさを考慮し、数値と同じ方向に読めるように取り付ける。水平のときは左から右、垂直のときは、下から上にカラーコードが読めるようにする。配布した段ボールで上から抑え、ひっくり返すとはんだ付けしやすくなる。

まずひと通り、片足側だけをはんだ付けする。片足だけはんだ付けしたら、基板をひっくり返し取り付け状態を確認する。このときリード線がじゃまならリード線を切り落としても良い。

はんだのつけ忘れ、不良がないか確認する。はんだ付けの状態が悪ければ再度、コテを当ててハンダを追加する。

### ステップ２　フォトカプラをつける

小さい４本足の IC がフォトカプラである。電気信号を光にして、受光すれば出力が ON になる素子である (センサ工学を思い出して！)。
◯マーク１番ピンを示している。基板のシルク印刷と合わせて配置する。

抵抗同様に配置したあと段ボールで押さえてひっくり返すとよい。

なお新品の IC チップは足が垂直よりひろがっている。ピンそろったーをつかって足を揃える。

### ステップ３　OP アンプをつける

OP アンプはアナログ信号のバッファのために使用している。交換が可能なように、基板には IC ソケットをはんだ付けし、ソケットにさして利用する。

IC ソケットにも切り欠き部分があるので、切り欠き部分をシルク印刷と合わせる (上に向ける)。

### ステップ４　ダイオード
